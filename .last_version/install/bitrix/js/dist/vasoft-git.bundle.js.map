{"version":3,"file":"vasoft-git.bundle.js","sources":["../src/api/useStorage.js","../src/directives/focus.js","../src/components/CommandInput/CommandInput.js","../src/components/CommandLine/CommandLine.js","../src/api/client.js","../src/components/Console/Console.js","../src/application.js"],"sourcesContent":["export function useStorage() {\n    const maxHistory = 100;\n    let commands = [];\n    let position = 0;\n\n    const load = () => {\n        const ls = localStorage['commands'];\n        if (ls) {\n            commands = JSON.parse(ls);\n        }\n    }\n    load();\n\n    const addCommand = function (command) {\n        if (commands.length > maxHistory) {\n            commands.shift();\n        }\n        commands.push(command);\n        localStorage['commands'] = JSON.stringify(commands);\n    };\n\n    const getPrevCommand = function () {\n        ++position;\n        return position <= commands.length ? commands[position - 1] : '';\n    }\n    const getNextCommand = function () {\n        --position;\n        return position >= 1 ? commands[position - 1] : '';\n    }\n    return {getNextCommand, getPrevCommand, addCommand};\n}","const Focus = {\n    mounted: (el, binding) => {\n        if (binding.value) {\n            el.focus();\n        }\n    },\n};\nexport default Focus;","import './CommandInput.css';\nimport {useStorage} from '../../api/useStorage';\nimport Focus from '../../directives/focus';\n\nconst commandStorage = useStorage();\n\nexport const CommandInput = {\n    directives: {\n        Focus\n    },\n    props: {\n        modelValue: String,\n        autocomplete: Array\n    },\n    data() {\n        return {\n            echo: ''\n        }\n    },\n    emits: ['update:modelValue', 'execute'],\n    // language=Vue\n    methods: {\n        keydown(event) {\n            if (event.keyCode === 9) { // Tab\n                this.$emit('update:modelValue', this.echo);\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 13) { //Enter\n                if (this.modelValue !== '') {\n                    commandStorage.addCommand(this.modelValue);\n                    this.$emit('execute');\n                }\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 38) { // Up\n                this.$emit('update:modelValue', commandStorage.getPrevCommand());\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 40) { //Down\n                this.$emit('update:modelValue', commandStorage.getNextCommand());\n                event.preventDefault();\n                return false;\n            }\n        },\n        update() {\n            this.echo = this.modelValue + this.search(this.modelValue);\n        },\n        search(command) {\n            let list = [];\n            for (let key in this.autocomplete) {\n                if (!this.autocomplete.hasOwnProperty(key)) {\n                    continue;\n                }\n                let pattern = new RegExp(key);\n                if (command.match(pattern)) {\n                    list = this.autocomplete[key];\n                }\n            }\n            let text = command.split(' ').pop();\n            let found = '';\n            if (text !== '') {\n                for (let i = 0; i < list.length; i++) {\n                    let value = list[i];\n                    if (value.length > text.length && value.substring(0, text.length) === text) {\n                        found = value.substring(text.length, value.length);\n                        break;\n                    }\n                }\n            }\n            return found;\n        }\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-input\">\n      <input type=\"text\" class=\"vsg-input__input\"\n             v-focus=\"true\"\n             @input=\"$emit('update:modelValue',$event.target.value)\"\n             v-model=\"modelValue\"\n             @keydown=\"keydown\"\n             @keyup=\"update\"/>\n      <div class=\"vsg-input__echo\">{{echo}}</div>\n      </div>\n    `\n};","import './CommandLine.css';\nimport {CommandInput} from '../CommandInput/CommandInput';\n\nexport const CommandLine = {\n    components: {\n        CommandInput\n    },\n    props: {\n        user: String,\n        path: String,\n        autocomplete: Array\n    },\n    data() {\n        return {\n            command: ''\n        }\n    },\n    emits: ['execute'],\n    methods: {\n        exec() {\n            this.$emit('execute', this.command);\n            this.command = '';\n        },\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-cmd\">\n      <div class=\"vsg-cmd__info\">{{path}}</div>\n      <div class=\"vsg-cmd__info\">{{user}}$</div>\n      <CommandInput class=\"vsg-cmd__input\" v-model=\"command\" :autocomplete=\"autocomplete\" @execute=\"exec\"/>\n      </div>\n    `\n};","export function useClient() {\n    const get = function (method: String, data: Object) {\n        return BX.ajax.runAction('vasoft:git.ConsoleController.' + method, {\n            json: data\n        });\n    }\n    const init = function () {\n        return get('environment', {});\n    }\n    const execute = function (command) {\n        return get('execute', {command: command});\n    }\n    return {init, execute};\n}","import './Console.css';\nimport {CommandLine} from '../CommandLine/CommandLine';\nimport {useClient} from '../../api/client';\n\nconst client = useClient();\n\nexport const Console = {\n    components: {\n        CommandLine\n    },\n    data(): Object {\n        return {\n            user: '',\n            path: '',\n            autocomplete: [],\n            output: '',\n            error: '',\n        }\n    },\n    methods: {\n        scroll() {\n        },\n        exec(command) {\n            client.execute(command).then(this.onData).catch(this.onError);\n        },\n        onError(response) {\n            if (response.hasOwnProperty('errors') && response.errors.length > 0) {\n                let i = 0, cnt = response.errors.length;\n                let errorText = '';\n                for (; i < cnt; ++i) {\n                    let error = response.errors[i];\n                    if (error.hasOwnProperty('code') && error.hasOwnProperty('message') && error.code > 5000) {\n                        errorText += \"\\n\" + response.errors[i].message;\n                    }\n                }\n                this.error = errorText;\n            }\n        },\n        onData(response) {\n            if (!response.hasOwnProperty('data')) {\n                return;\n            }\n            if (response.data.hasOwnProperty('user')) {\n                this.user = response.data.user;\n            }\n            if (response.data.hasOwnProperty('path')) {\n                this.path = response.data.path;\n            }\n            if (response.data.hasOwnProperty('autocomplete')) {\n                this.autocomplete = response.data.autocomplete;\n            }\n            if (response.data.hasOwnProperty('output')) {\n                this.output = response.data.output;\n            }\n            if (response.data.hasOwnProperty('error')) {\n                this.error = response.data.error;\n            }\n        }\n    },\n    updated() {\n        let container = this.$el.querySelector('#vsg-terminal');\n        container.scrollTop = container.scrollHeight;\n    },\n    beforeMount() {\n        client.init().then(this.onData);\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-console\">\n      <pre id=\"vsg-terminal\" class=\"vsg-terminal\" v-show=\"output.length>0\">{{output}}</pre>\n      <pre class=\"vsg-error\" v-show=\"error.length>0\">{{error}}</pre>\n      <CommandLine :user=\"user\" :path=\"path\" :autocomplete=\"autocomplete\" @execute=\"exec\"/>\n      </div>\n    `\n};","/**\n * Консоль Git\n *\n * @package vasoft.git\n * @subpackage js.module\n * @copyright 2023\n */\n\nimport {BitrixVue} from 'ui.vue3';\nimport {Console} from './components/Console/Console';\n\n\nexport class GitConsole {\n    #application;\n    #rootNode;\n    constructor(rootNode): void {\n        this.#rootNode = document.querySelector(rootNode);\n    }\n    start(): void {\n        this.#application = BitrixVue.createApp({\n            name: 'Git Console Application',\n            components: {\n                Console\n            },\n            template: '<Console/>'\n        })\n        this.#application.mount(this.#rootNode);\n    }\n}\n"],"names":["useStorage","maxHistory","commands","position","load","ls","localStorage","JSON","parse","addCommand","command","length","shift","push","stringify","getPrevCommand","getNextCommand","Focus","mounted","el","binding","value","focus","commandStorage","CommandInput","directives","props","modelValue","String","autocomplete","Array","data","echo","emits","methods","keydown","event","keyCode","$emit","preventDefault","update","search","list","key","hasOwnProperty","pattern","RegExp","match","text","split","pop","found","i","substring","template","CommandLine","components","user","path","exec","useClient","get","method","BX","ajax","runAction","json","init","execute","client","Console","output","error","scroll","then","onData","onError","response","errors","cnt","errorText","code","message","updated","container","$el","querySelector","scrollTop","scrollHeight","beforeMount","GitConsole","rootNode","document","BitrixVue","createApp","name","mount"],"mappings":"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"}