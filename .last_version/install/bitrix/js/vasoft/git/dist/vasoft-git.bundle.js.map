{"version":3,"file":"vasoft-git.bundle.js","sources":["../src/api/useStorage.js","../src/directives/focus.js","../src/components/CommandInput/CommandInput.js","../src/components/CommandLine/CommandLine.js","../src/api/client.js","../src/components/Console/Console.js","../src/application.js"],"sourcesContent":["export function useStorage() {\n    const maxHistory = 100;\n    let commands = [];\n    let position = 0;\n\n    const load = () => {\n        const ls = localStorage['commands'];\n        if (ls) {\n            commands = JSON.parse(ls);\n        }\n    }\n    load();\n\n    const addCommand = function (command) {\n        if (commands.length > maxHistory) {\n            commands.shift();\n        }\n        commands.push(command);\n        localStorage['commands'] = JSON.stringify(commands);\n    };\n\n    const getPrevCommand = function () {\n        ++position;\n        return position <= commands.length ? commands[position - 1] : '';\n    }\n    const getNextCommand = function () {\n        --position;\n        return position >= 1 ? commands[position - 1] : '';\n    }\n    return {getNextCommand, getPrevCommand, addCommand};\n}","const Focus = {\n    mounted: (el, binding) => {\n        if (binding.value) {\n            el.focus();\n        }\n    },\n};\nexport default Focus;","import './CommandInput.css';\nimport {useStorage} from '../../api/useStorage';\nimport Focus from '../../directives/focus';\n\nconst commandStorage = useStorage();\n\nexport const CommandInput = {\n    directives: {\n        Focus\n    },\n    props: {\n        modelValue: String,\n        autocomplete: Array\n    },\n    data() {\n        return {\n            echo: ''\n        }\n    },\n    emits: ['update:modelValue', 'execute'],\n    // language=Vue\n    methods: {\n        keydown(event) {\n            if (event.keyCode === 9) { // Tab\n                this.$emit('update:modelValue', this.echo);\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 13) { //Enter\n                if (this.modelValue !== '') {\n                    commandStorage.addCommand(this.modelValue);\n                    this.$emit('execute');\n                }\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 38) { // Up\n                this.$emit('update:modelValue', commandStorage.getPrevCommand());\n                event.preventDefault();\n                return false;\n            } else if (event.keyCode === 40) { //Down\n                this.$emit('update:modelValue', commandStorage.getNextCommand());\n                event.preventDefault();\n                return false;\n            }\n        },\n        update() {\n            this.echo = this.modelValue + this.search(this.modelValue);\n        },\n        search(command) {\n            let list = [];\n            for (let key in this.autocomplete) {\n                if (!this.autocomplete.hasOwnProperty(key)) {\n                    continue;\n                }\n                let pattern = new RegExp(key);\n                if (command.match(pattern)) {\n                    list = this.autocomplete[key];\n                }\n            }\n            let text = command.split(' ').pop();\n            let found = '';\n            if (text !== '') {\n                for (let i = 0; i < list.length; i++) {\n                    let value = list[i];\n                    if (value.length > text.length && value.substring(0, text.length) === text) {\n                        found = value.substring(text.length, value.length);\n                        break;\n                    }\n                }\n            }\n            return found;\n        }\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-input\">\n      <input type=\"text\" class=\"vsg-input__input\"\n             v-focus=\"true\"\n             @input=\"$emit('update:modelValue',$event.target.value)\"\n             v-model=\"modelValue\"\n             @keydown=\"keydown\"\n             @keyup=\"update\"/>\n      <div class=\"vsg-input__echo\">{{echo}}</div>\n      </div>\n    `\n};","import './CommandLine.css';\nimport {CommandInput} from '../CommandInput/CommandInput';\n\nexport const CommandLine = {\n    components: {\n        CommandInput\n    },\n    props: {\n        user: String,\n        path: String,\n        autocomplete: Array\n    },\n    data() {\n        return {\n            command: ''\n        }\n    },\n    emits: ['execute'],\n    methods: {\n        exec() {\n            this.$emit('execute', this.command);\n            this.command = '';\n        },\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-cmd\">\n      <div class=\"vsg-cmd__info\">{{path}}</div>\n      <div class=\"vsg-cmd__info\">{{user}}$</div>\n      <CommandInput class=\"vsg-cmd__input\" v-model=\"command\" :autocomplete=\"autocomplete\" @execute=\"exec\"/>\n      </div>\n    `\n};","export function useClient() {\n    const get = function (method: String, data: Object) {\n        return BX.ajax.runAction('vasoft:git.ConsoleController.' + method, {\n            json: data\n        });\n    }\n    const init = function () {\n        return get('environment', {});\n    }\n    const execute = function (command) {\n        return get('execute', {command: command});\n    }\n    return {init, execute};\n}","import './Console.css';\nimport {CommandLine} from '../CommandLine/CommandLine';\nimport {useClient} from '../../api/client';\n\nconst client = useClient();\n\nexport const Console = {\n    components: {\n        CommandLine\n    },\n    data(): Object {\n        return {\n            user: '',\n            path: '',\n            autocomplete: [],\n            output: '',\n            error: '',\n        }\n    },\n    methods: {\n        scroll() {\n        },\n        execTagLog(){\n            console.log('execTagLog');\n            this.exec('git log --no-walk --tags --pretty=\"%h %d %s%n%b\" --decorate=short');\n        },\n        exec(command) {\n            console.log('exec', command);\n            client.execute(command).then(this.onData).catch(this.onError);\n        },\n        onError(response) {\n            if (response.hasOwnProperty('errors') && response.errors.length > 0) {\n                let i = 0, cnt = response.errors.length;\n                let errorText = '';\n                for (; i < cnt; ++i) {\n                    let error = response.errors[i];\n                    if (error.hasOwnProperty('code') && error.hasOwnProperty('message') && error.code >= 5000) {\n                        errorText += \"\\n\" + response.errors[i].message;\n                    }\n                }\n                this.error = errorText;\n            }\n        },\n        onData(response) {\n            if (!response.hasOwnProperty('data')) {\n                return;\n            }\n            if (response.data.hasOwnProperty('user')) {\n                this.user = response.data.user;\n            }\n            if (response.data.hasOwnProperty('path')) {\n                this.path = response.data.path;\n            }\n            if (response.data.hasOwnProperty('autocomplete')) {\n                this.autocomplete = response.data.autocomplete;\n            }\n            if (response.data.hasOwnProperty('output')) {\n                this.output = response.data.output;\n            }\n            if (response.data.hasOwnProperty('error')) {\n                this.error = response.data.error;\n            }\n        }\n    },\n    updated() {\n        let container = this.$el.querySelector('#vsg-terminal');\n        container.scrollTop = container.scrollHeight;\n    },\n    beforeMount() {\n        client.init().then(this.onData);\n    },\n    // language=Vue\n    template: `\n      <div class=\"vsg-console\">\n      <div class=\"vsg-console__buttons\">\n        <button @click=\"execTagLog\">Tag log</button>\n      </div>\n      <pre id=\"vsg-terminal\" class=\"vsg-terminal\" v-show=\"output.length>0\">{{output}}</pre>\n      <pre class=\"vsg-error\" v-show=\"error.length>0\">{{error}}</pre>\n      <CommandLine :user=\"user\" :path=\"path\" :autocomplete=\"autocomplete\" @execute=\"exec\"/>\n      </div>\n    `\n};","/**\n * Консоль Git\n *\n * @package vasoft.git\n * @subpackage js.module\n * @copyright 2023\n */\n\nimport {BitrixVue} from 'ui.vue3';\nimport {Console} from './components/Console/Console';\n\n\nexport class GitConsole {\n    #application;\n    #rootNode;\n    constructor(rootNode): void {\n        this.#rootNode = document.querySelector(rootNode);\n    }\n    start(): void {\n        this.#application = BitrixVue.createApp({\n            name: 'Git Console Application',\n            components: {\n                Console\n            },\n            template: '<Console/>'\n        })\n        this.#application.mount(this.#rootNode);\n    }\n}\n"],"names":["useStorage","maxHistory","commands","position","load","ls","localStorage","JSON","parse","addCommand","command","length","shift","push","stringify","getPrevCommand","getNextCommand","Focus","mounted","el","binding","value","focus","commandStorage","CommandInput","directives","props","modelValue","String","autocomplete","Array","data","echo","emits","methods","keydown","event","keyCode","$emit","preventDefault","update","search","list","key","hasOwnProperty","pattern","RegExp","match","text","split","pop","found","i","substring","template","CommandLine","components","user","path","exec","useClient","get","method","BX","ajax","runAction","json","init","execute","client","Console","output","error","scroll","execTagLog","console","log","then","onData","onError","response","errors","cnt","errorText","code","message","updated","container","$el","querySelector","scrollTop","scrollHeight","beforeMount","GitConsole","rootNode","document","BitrixVue","createApp","name","mount"],"mappings":"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"}